<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= article.title %> - Modern Blog</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
    <%- include('partials/navbar') %>
    
    <main class="main-content">
        <!-- Hero Section -->
        <div class="article-hero">
            <div class="hero-overlay">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8 col-md-10">
                            <div class="hero-content">
                                <!-- Article Meta -->
                                <div class="article-meta-top">
                                    <span class="category-tag <%= article.category.toLowerCase() %>">
                                        <i class="fas fa-folder-open"></i>
                                        <%= article.category %>
                                    </span>
                                    <span class="read-time">
                                        <i class="fas fa-clock"></i>
                                        <%= article.readTime %> min read
                                    </span>
                                    <% if (article.status !== 'published') { %>
                                        <span class="status-badge status-<%= article.status %>">
                                            <i class="fas fa-eye-slash"></i>
                                            <%= article.status.charAt(0).toUpperCase() + article.status.slice(1) %>
                                        </span>
                                    <% } %>
                                </div>
                                
                                <!-- Article Title -->
                                <h1 class="hero-title"><%= article.title %></h1>
                                
                                <!-- Article Summary -->
                                <% if (article.summary) { %>
                                    <p class="hero-summary"><%= article.summary %></p>
                                <% } %>
                                
                                <!-- Author Info -->
                                <div class="hero-meta">
                                    <div class="author-section">
                                        <div class="author-avatar">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <div class="author-info">
                                            <div class="author-name">
                                                <a href="/users/<%= article.author._id %>"><%= article.author.fullName %></a>
                                            </div>
                                            <div class="publish-date">
                                                <i class="fas fa-calendar-alt"></i>
                                                <% if (article.publishedAt) { %>
                                                    <%= new Date(article.publishedAt).toLocaleDateString('en-US', { 
                                                        year: 'numeric', 
                                                        month: 'long', 
                                                        day: 'numeric' 
                                                    }) %>
                                                <% } else { %>
                                                    <%= new Date(article.createdAt).toLocaleDateString('en-US', { 
                                                        year: 'numeric', 
                                                        month: 'long', 
                                                        day: 'numeric' 
                                                    }) %>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <% if (user && user.role === 'admin') { %>
                                    <div class="hero-actions">
                                        <a href="/articles/<%= article._id %>/edit" class="btn btn-primary btn-action">
                                            <i class="fas fa-edit"></i>
                                            Edit Article
                                        </a>
                                        <a href="/articles/my" class="btn btn-secondary btn-action">
                                            <i class="fas fa-arrow-left"></i>
                                            My Articles
                                        </a>
                                        <form method="POST" action="/articles/<%= article._id %>/delete" class="d-inline">
                                            <button type="submit" class="btn btn-danger btn-action" onclick="return confirm('Are you sure you want to delete this article?')">
                                                <i class="fas fa-trash"></i>
                                                Delete
                                            </button>
                                        </form>
                                    </div>
                                <% } else { %>
                                    <div class="hero-actions">
                                        <a href="/articles" class="btn btn-secondary btn-action">
                                            <i class="fas fa-arrow-left"></i>
                                            Back to Articles
                                        </a>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Article Content -->
        <div class="article-content-section">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 col-md-10">
                        <article class="article-content">
                            <!-- Featured Image -->
                            <% if (article.featuredImage) { %>
                                <div class="featured-image">
                                    <img src="<%= article.featuredImage %>" alt="<%= article.title %>" class="img-fluid">
                                </div>
                            <% } %>
                            
                            <!-- Article Body -->
                            <div class="article-body">
                                <%- article.content.replace(/\n/g, '<br>') %>
                            </div>
                            
                            <!-- Tags Section -->
                            <% if (article.tags && article.tags.length > 0) { %>
                                <div class="tags-section">
                                    <h5 class="tags-title">
                                        <i class="fas fa-tags"></i>
                                        Tags
                                    </h5>
                                    <div class="tags-list">
                                        <% article.tags.forEach(tag => { %>
                                            <span class="tag-item">
                                                <i class="fas fa-tag"></i>
                                                <%= tag %>
                                            </span>
                                        <% }) %>
                                    </div>
                                </div>
                            <% } %>
                            
                            <!-- Share Section -->
                            <div class="share-section">
                                <h5 class="share-title">
                                    <i class="fas fa-share-alt"></i>
                                    Share this article
                                </h5>
                                <div class="share-buttons">
                                    <button class="share-btn twitter" onclick="shareOnTwitter()">
                                        <i class="fab fa-twitter"></i>
                                        Twitter
                                    </button>
                                    <button class="share-btn facebook" onclick="shareOnFacebook()">
                                        <i class="fab fa-facebook-f"></i>
                                        Facebook
                                    </button>
                                    <button class="share-btn linkedin" onclick="shareOnLinkedIn()">
                                        <i class="fab fa-linkedin-in"></i>
                                        LinkedIn
                                    </button>
                                    <button class="share-btn copy" onclick="copyToClipboard()">
                                        <i class="fas fa-link"></i>
                                        Copy Link
                                    </button>
                                </div>
                            </div>
                        </article>
                    </div>
                </div>
            </div>
        </div>
    
    <!-- Comments Section -->
    <section class="comments-section">
        <h3>Comments (<%= article.commentCount %>)</h3>
        
        <% if (user) { %>
            <form class="comment-form">
                <div class="form-group">
                    <textarea placeholder="Write a comment..." rows="3" class="form-textarea"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-comment"></i>
                    Post Comment
                </button>
            </form>
        <% } else { %>
            <div class="login-prompt">
                <p>Please <a href="/auth/login">login</a> to leave a comment.</p>
            </div>
        <% } %>
        
        <div class="comments-list">
            <% if (article.comments && article.comments.length > 0) { %>
                <% article.comments.forEach(comment => { %>
                    <div class="comment">
                        <div class="comment-author">
                            <i class="fas fa-user"></i>
                            <span><%= comment.author.fullName %></span>
                            <span class="comment-date">
                                <%= new Date(comment.createdAt).toLocaleDateString() %>
                            </span>
                        </div>
                        <div class="comment-content">
                            <%= comment.content %>
                        </div>
                    </div>
                <% }) %>
            <% } else { %>
                <div class="no-comments">
                    <p>No comments yet. Be the first to comment!</p>
                </div>
            <% } %>
        </div>
    </section>
    
    <!-- Related Articles -->
    <section class="related-articles">
        <h3>You might also like</h3>
        <div class="related-grid">
            <!-- This would be populated with related articles -->
            <p>Related articles would be shown here based on category or tags.</p>
        </div>
    </section>
</div>

<script>
function shareOnTwitter() {
    const url = encodeURIComponent(window.location.href);
    const text = encodeURIComponent('<%= article.title %>');
    window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
}

function shareOnFacebook() {
    const url = encodeURIComponent(window.location.href);
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
}

function shareOnLinkedIn() {
    const url = encodeURIComponent(window.location.href);
    const title = encodeURIComponent('<%= article.title %>');
    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&title=${title}`, '_blank');
}

function copyToClipboard() {
    navigator.clipboard.writeText(window.location.href).then(() => {
        alert('Link copied to clipboard!');
    });
}
</script>
        </div>
    </main>
    
    <%- include('partials/footer') %>
    
    <script src="/js/main.js"></script>
</body>
</html>