<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Articles - Modern Blog</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
    <%- include('partials/navbar') %>
    
    <main class="main-content">
        <div class="container">
            <div class="page-header">
                <h1>All Articles</h1>
                <p>Discover amazing stories and insights from our community</p>
            </div>
    
            <!-- Search and Filter Section -->
            <div class="filters-section">
                <form method="GET" class="search-form">
                    <div class="search-bar">
                        <input type="text" name="search" placeholder="Search articles..." value="<%= searchQuery %>" class="search-input">
                        <button type="submit" class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    
                    <div class="filter-group">
                        <select name="category" class="filter-select" onchange="this.form.submit()">
                            <option value="all" <%= currentCategory === 'all' ? 'selected' : '' %>>All Categories</option>
                            <% categories.forEach(category => { %>
                                <option value="<%= category %>" <%= currentCategory === category ? 'selected' : '' %>>
                                    <%= category %>
                                </option>
                            <% }) %>
                        </select>
                    </div>
                </form>
            </div>
            
            <!-- Articles Grid -->
            <% if (articles.length > 0) { %>
                <div class="articles-grid">
                    <% articles.forEach(article => { %>
                        <article class="article-card">
                            <!-- Featured Image -->
                            <% if (article.featuredImage) { %>
                                <div class="article-image">
                                    <img src="<%= article.featuredImage %>" alt="<%= article.title %>">
                                </div>
                            <% } %>
                            
                            <div class="article-content">
                                <div class="article-meta">
                                    <span class="category-tag <%= article.category.toLowerCase() %>">
                                        <%= article.category %>
                                    </span>
                                    <span class="read-time">
                                        <i class="fas fa-clock"></i>
                                        <%= article.readTime %> min read
                                    </span>
                                </div>
                                
                                <h2 class="article-title">
                                    <a href="/articles/<%= article._id %>"><%= article.title %></a>
                                </h2>
                                
                                <p class="article-summary">
                                    <%= article.summary || article.content.substring(0, 150) + '...' %>
                                </p>
                                
                                <div class="article-date">
                                    <i class="fas fa-calendar"></i>
                                    <%= new Date(article.publishedAt || article.createdAt).toLocaleDateString() %>
                                </div>
                                
                                <!-- Read Full Article Link -->
                                <a href="/articles/<%= article._id %>" class="read-more-link">
                                    Read Full Article
                                    <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                        </article>
                    <% }) %>
                </div>
                
                <!-- Pagination -->
                <% if (totalPages > 1) { %>
                    <div class="pagination">
                        <% if (hasPrevPage) { %>
                            <a href="?page=<%= prevPage %>&category=<%= currentCategory %>&search=<%= searchQuery %>" class="page-btn">
                                <i class="fas fa-chevron-left"></i>
                                Previous
                            </a>
                        <% } %>
                        
                        <div class="page-numbers">
                            <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
                                <a href="?page=<%= i %>&category=<%= currentCategory %>&search=<%= searchQuery %>" 
                                   class="page-number <%= i === currentPage ? 'active' : '' %>">
                                    <%= i %>
                                </a>
                            <% } %>
                        </div>
                        
                        <% if (hasNextPage) { %>
                            <a href="?page=<%= nextPage %>&category=<%= currentCategory %>&search=<%= searchQuery %>" class="page-btn">
                                Next
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        <% } %>
                    </div>
                    
                    <div class="pagination-info">
                        Showing <%= (currentPage - 1) * 10 + 1 %>-<%= Math.min(currentPage * 10, totalArticles) %> of <%= totalArticles %> articles
                    </div>
                <% } %>
            <% } else { %>
                <div class="no-articles">
                    <i class="fas fa-file-alt fa-3x"></i>
                    <h3>No articles found</h3>
                    <p>
                        <% if (searchQuery) { %>
                            No articles match your search criteria.
                        <% } else { %>
                            There are no published articles yet.
                        <% } %>
                    </p>
                    <% if (isAuthenticated && isAdmin) { %>
                        <a href="/articles/new" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Write First Article
                        </a>
                    <% } %>
                </div>
            <% } %>
        </div>
    </main>
    
    <%- include('partials/footer') %>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="/js/main.js"></script>
</body>
</html>